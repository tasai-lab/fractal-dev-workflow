---
name: user-guide
description: プラグインの使い方とトラブルシューティング。AIが期待通りに動かない時に参照。
---

# User Guide（使用ガイド）

## Overview

このプラグインは「構造主義的な開発プロトコル」を提供する。

**核心思想:**
- ファイルシステムを唯一の真実（Single Source of Truth）とする
- ユーザーは「指揮官」として指示を出し、成果物を監査する
- AIは「執行者」として仕様書に従い実装する

**最大のストレス要因を排除:**
1. AIが勝手な判断をして仕様をねじ曲げる
2. コンテキストが汚れて指示が通らなくなる

---

## Agent Architecture

4つの役割特化型エージェントで分業する。

| Agent | 役割 | 権限 | 呼び出し方 |
|-------|------|------|-----------|
| **Architect** | 設計参謀 | 読み書き可 | `@Architect` |
| **TechLead** | タスク分解 | 読み書き可 | `@TechLead` |
| **Coder** | TDD実装 | 読み書き可 | `@Coder` |
| **QA** | 品質監査 | **読み取りのみ** | `@QA` |

### Architect（設計参謀）

**役割:** ユーザーの抽象的な指示を、実装可能な仕様書に変換する。

**成果物:**
- `docs/prd.md` - 要件定義書
- `docs/api_spec.yaml` - API仕様（OpenAPI）
- `docs/schema.prisma` - DBスキーマ

**重要:** 承認なしに次フェーズへ進んではいけない。

### TechLead（技術分解）

**役割:** 仕様書を「作業手順」にバラす。

**成果物:**
- `docs/tasks.md` - チェックボックス付きタスクリスト

**原則:**
- 縦切り分解（1時間以内に完了できる粒度）
- 依存関係を明示
- 各タスクに完了条件を記載

### Coder（実装工兵）

**役割:** タスクリストに従い、TDDで実装する。

**原則:**
- **テストを先に書く**（RED→GREEN→REFACTOR）
- 仕様書に従う（勝手に仕様を変えない）
- 2箇所以上で使うコードは共通化

### QA（品質憲兵）

**役割:** 品質監査（指摘のみ、編集禁止）

**禁止事項:**
- ファイルを編集してはいけない
- 問題を発見したら指摘のみを行う
- 修正は Coder に依頼する

**チェック項目:**
- テストカバレッジ
- セキュリティ（OWASP Top 10）
- 仕様との整合性

---

## Workflow（7フェーズ）

```
Phase 1: 要件定義   → Architect
Phase 2: 調査       → Investigator
Phase 3: 設計       → Architect     ★承認必須
Phase 4: レビュー   → Codex
Phase 5: 実装       → TechLead + Coder  ★承認必須
Phase 6: 検証       → QA
Phase 7: 完了       → Architect
```

### 起動方法

```bash
/dev [タスク説明]      # 新規ワークフロー開始
/dev resume            # 中断したワークフローを再開
/dev status            # 現在の状態を確認
```

---

## Troubleshooting

### AIが仕様を変えてしまう

**原因:** コンテキストが汚染されている

**対処:**
1. `docs/prd.md` を確認（仕様書が正しいか）
2. Architect を再起動して仕様書を再読込させる
3. 必要なら `/compact` でコンテキストをリフレッシュ

```
@Architect docs/prd.md を読み直して、この仕様に厳密に従ってください。
```

### 実装が沼にハマる

**原因:** 1つのアプローチに固執している

**対処:**
1. Architect に代替案を提示させる
2. 複数のアプローチを比較検討
3. 最も単純なアプローチを選択

```
@Architect 現在のアプローチが詰まっています。代替案を3つ提示してください。
```

### テストが通らないのに完了を主張

**原因:** テストコードを改竄している可能性

**対処:**
1. QA にテストコード自体を監査させる
2. テストカバレッジを確認
3. 改竄があれば Coder にやり直しを指示

```
@QA テストコードが正しいか監査してください。改竄がないか確認。
```

### コンテキストがボケてきた

**原因:** 会話が長すぎてコンテキストが劣化

**対処:**
1. `/compact` でコンテキストをリフレッシュ
2. 重要な情報は `docs/` 配下のファイルに永続化
3. 新しい会話を開始

```
/compact
```

### エージェントが指示を無視する

**原因:** 指示が曖昧 or プロンプトが流されている

**対処:**
1. 指示を具体的に書き直す
2. ファイルパスを明示
3. 「〜など」「〜等」を使わない

**悪い例:**
```
ログイン機能を作って
```

**良い例:**
```
@Coder docs/tasks.md の Task 1 を実装してください。
- ファイル: src/auth/login.ts
- テスト: src/auth/login.test.ts
- 完了条件: テストがパスすること
```

---

## Best Practices

### 1. ファイルシステムを唯一の真実にする

- 重要な決定は必ず `docs/` 配下に記録
- 会話で決まったことは仕様書に反映
- 口頭での合意は存在しない

### 2. 承認ポイントを守る

- Phase 3（設計）と Phase 5（実装）は承認必須
- 承認なしに次へ進まない
- 「たぶん大丈夫」は禁止

### 3. 段階的に進める

- 一度に全部やろうとしない
- 縦スライスで最小動作を先に出す
- 動くものを見てから判断

### 4. QA は編集させない

- QA の役割は監査のみ
- 問題を見つけたら Coder に修正させる
- QA が直接コードを触ると責任が曖昧になる

---

## Related Skills

- `dev-workflow` - 開発ワークフロー全体
- `project-setup` - プロジェクト初期化
- `requirements` - 要件定義
- `implementation` - 実装
- `testing` - テスト戦略
